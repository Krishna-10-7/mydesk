<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: wss: data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.socket.io; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' wss: ws: https:; media-src 'self' mediastream:;">
  <title>MyDesk - Remote Desktop</title>
  <link rel="stylesheet" href="styles/app.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <div id="app">
    <!-- Title Bar -->
    <div class="title-bar" id="titleBar">
      <div class="title-bar-drag">
        <div class="app-logo">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="4" width="20" height="14" rx="2" stroke="url(#gradient)" stroke-width="2" />
            <path d="M8 22h8M12 18v4" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradient" x1="2" y1="4" x2="22" y2="22">
                <stop stop-color="#6366f1" />
                <stop offset="1" stop-color="#a855f7" />
              </linearGradient>
            </defs>
          </svg>
          <span>MyDesk</span>
        </div>
      </div>
      <div class="window-controls">
        <button class="control-btn minimize" id="minimizeBtn">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <path d="M2 6h8" stroke="currentColor" stroke-width="1.5" />
          </svg>
        </button>
        <button class="control-btn maximize" id="maximizeBtn">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <rect x="2" y="2" width="8" height="8" stroke="currentColor" stroke-width="1.5" fill="none" />
          </svg>
        </button>
        <button class="control-btn close" id="closeBtn">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <path d="M2 2l8 8M10 2l-8 8" stroke="currentColor" stroke-width="1.5" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Home Screen -->
      <div id="homeScreen" class="screen active">
        <div class="hero-section">
          <div class="hero-icon">
            <div class="icon-glow"></div>
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
              <rect x="2" y="4" width="20" height="14" rx="2" stroke="url(#heroGrad)" stroke-width="1.5" />
              <path d="M8 22h8M12 18v4" stroke="url(#heroGrad)" stroke-width="1.5" stroke-linecap="round" />
              <circle cx="12" cy="11" r="3" stroke="url(#heroGrad)" stroke-width="1.5" />
              <defs>
                <linearGradient id="heroGrad" x1="2" y1="4" x2="22" y2="22">
                  <stop stop-color="#6366f1" />
                  <stop offset="1" stop-color="#a855f7" />
                </linearGradient>
              </defs>
            </svg>
          </div>
          <h1>Welcome to <span class="gradient-text">MyDesk</span></h1>
          <p class="subtitle">Free, secure remote desktop sharing</p>
          <div id="serverStatus" class="server-status">
            <span class="status-dot"></span>
            <span class="status-text">Connecting to server...</span>
          </div>
        </div>

        <div class="action-cards">
          <div class="action-card host-card" id="hostBtn">
            <div class="card-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                <rect x="3" y="4" width="18" height="12" rx="2" stroke="currentColor" stroke-width="1.5" />
                <path d="M7 20h10M12 16v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                <circle cx="12" cy="10" r="2" stroke="currentColor" stroke-width="1.5" />
                <path d="M12 6v1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
              </svg>
            </div>
            <div class="card-content">
              <h3>Share My Screen</h3>
              <p>Let others view and control your desktop</p>
            </div>
            <div class="card-arrow">→</div>
          </div>

          <div class="action-card connect-card" id="connectBtn">
            <div class="card-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                <path d="M9 3H5a2 2 0 00-2 2v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                <path d="M15 3h4a2 2 0 012 2v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                <path d="M9 21H5a2 2 0 01-2-2v-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                <path d="M15 21h4a2 2 0 002-2v-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                <rect x="7" y="7" width="10" height="10" rx="2" stroke="currentColor" stroke-width="1.5" />
              </svg>
            </div>
            <div class="card-content">
              <h3>Connect to Remote</h3>
              <p>View and control another desktop</p>
            </div>
            <div class="card-arrow">→</div>
          </div>
        </div>
      </div>

      <!-- Host Screen -->
      <div id="hostScreen" class="screen">
        <button class="back-btn" id="hostBackBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          Back
        </button>

        <div class="host-container">
          <!-- Source Selection -->
          <div id="sourceSelection" class="source-selection">
            <h2>Select What to Share</h2>
            <p class="hint">Choose a screen or window to share</p>
            <div id="sourcesGrid" class="sources-grid">
              <!-- Sources will be populated here -->
            </div>
          </div>

          <!-- Sharing Active -->
          <div id="sharingActive" class="sharing-active hidden">
            <div class="connection-info">
              <div class="status-badge connected">
                <span class="pulse"></span>
                <span>Sharing Active</span>
              </div>
              <div class="room-id-container">
                <label>Your Connection ID</label>
                <div class="room-id-box">
                  <span id="roomIdDisplay">MDK-XXX-XXX</span>
                  <button id="copyRoomId" class="copy-btn" title="Copy to clipboard">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                      <rect x="9" y="9" width="13" height="13" rx="2" stroke="currentColor" stroke-width="1.5" />
                      <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke="currentColor"
                        stroke-width="1.5" />
                    </svg>
                  </button>
                </div>
                <p class="share-hint">Share this ID with anyone you want to connect</p>
              </div>
            </div>

            <div class="preview-container">
              <video id="previewVideo" autoplay muted></video>
              <div class="preview-overlay">
                <span>Preview</span>
              </div>
            </div>

            <div class="control-options">
              <label class="toggle-option">
                <input type="checkbox" id="allowControlToggle">
                <span class="toggle-slider"></span>
                <span class="toggle-label">Allow Remote Control</span>
              </label>
            </div>

            <div class="connected-viewers" id="connectedViewers">
              <h4>Connected Viewers</h4>
              <div id="viewersList" class="viewers-list">
                <p class="no-viewers">No viewers connected yet</p>
              </div>
            </div>

            <button id="stopSharingBtn" class="stop-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <rect x="6" y="6" width="12" height="12" rx="2" fill="currentColor" />
              </svg>
              Stop Sharing
            </button>
          </div>
        </div>
      </div>

      <!-- Connect Screen -->
      <div id="connectScreen" class="screen">
        <button class="back-btn" id="connectBackBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          Back
        </button>

        <div class="connect-container">
          <div class="connect-form" id="connectForm">
            <div class="form-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                <path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4" stroke="url(#connGrad)" stroke-width="1.5"
                  stroke-linecap="round" />
                <path d="M10 17l5-5-5-5" stroke="url(#connGrad)" stroke-width="1.5" stroke-linecap="round"
                  stroke-linejoin="round" />
                <path d="M15 12H3" stroke="url(#connGrad)" stroke-width="1.5" stroke-linecap="round" />
                <defs>
                  <linearGradient id="connGrad" x1="3" y1="3" x2="21" y2="21">
                    <stop stop-color="#10b981" />
                    <stop offset="1" stop-color="#06b6d4" />
                  </linearGradient>
                </defs>
              </svg>
            </div>
            <h2>Connect to Remote Desktop</h2>
            <p class="hint">Enter the Connection ID shared with you</p>

            <div class="input-group">
              <input type="text" id="roomIdInput" placeholder="MDK-XXX-XXX" maxlength="11" autocomplete="off">
              <button id="connectSubmitBtn" class="connect-submit-btn">
                Connect
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </button>
            </div>

            <div id="connectionStatus" class="connection-status hidden">
              <div class="status-spinner"></div>
              <span>Connecting...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Viewer Screen -->
      <div id="viewerScreen" class="screen">
        <div class="viewer-toolbar" id="viewerToolbar">
          <button class="toolbar-btn" id="viewerDisconnectBtn" title="Disconnect">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          </button>
          <div class="toolbar-divider"></div>
          <div class="toolbar-info">
            <span class="connection-indicator"></span>
            <span id="viewerRoomId">MDK-XXX-XXX</span>
          </div>
          <div class="toolbar-spacer"></div>
          <button class="toolbar-btn" id="fullscreenBtn" title="Fullscreen">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M8 3H5a2 2 0 00-2 2v3M21 8V5a2 2 0 00-2-2h-3M3 16v3a2 2 0 002 2h3M16 21h3a2 2 0 002-2v-3"
                stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
            </svg>
          </button>
        </div>
        <div class="remote-view-container">
          <video id="remoteVideo" autoplay></video>
          <div id="connectionLost" class="connection-lost hidden">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" />
              <path d="M15 9l-6 6M9 9l6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
            </svg>
            <h3>Connection Lost</h3>
            <p>The remote desktop has disconnected</p>
            <button id="reconnectBtn" class="reconnect-btn">Try Reconnecting</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="libs/socket.io.min.js"></script>

  <!-- Debug Console -->
  <div id="debugConsole"
    style="position: fixed; bottom: 0; left: 0; right: 0; height: 150px; background: rgba(0,0,0,0.9); color: #0f0; font-family: monospace; font-size: 12px; overflow-y: auto; z-index: 9999; padding: 10px; border-top: 1px solid #333; display: none;">
    <div
      style="position: sticky; top: 0; background: #000; padding-bottom: 5px; margin-bottom: 5px; border-bottom: 1px solid #333; display: flex; justify-content: space-between;">
      <span>Debug Log (v1.0.9)</span>
      <button onclick="document.getElementById('debugConsole').style.display='none'"
        style="background: #333; color: #fff; border: none; padding: 2px 5px; cursor: pointer;">Hide</button>
    </div>
    <div id="debugContent"></div>
  </div>
  <button onclick="document.getElementById('debugConsole').style.display='block'"
    style="position: fixed; bottom: 10px; right: 10px; z-index: 9998; opacity: 0.5; font-size: 10px;">Debug</button>

  <script src="app.js"></script>
</body>

</html>